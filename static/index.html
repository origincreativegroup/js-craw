<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Search Crawler</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: white;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 28px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            background: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tab:hover {
            background: #ecf0f1;
        }
        
        .tab.active:hover {
            background: #2980b9;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #3498db;
        }
        
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .job-card {
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .job-card:hover {
            transform: translateX(5px);
        }
        
        .job-card.new {
            border-left-color: #2ecc71;
            background: #e8f8f5;
        }
        
        .job-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .job-company {
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        
        .job-meta {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #95a5a6;
        }
        
        .match-score {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            background: #e8f5e9;
            color: #27ae60;
        }
        
        .match-score.high {
            background: #e8f5e9;
            color: #27ae60;
        }
        
        .match-score.medium {
            background: #fff3e0;
            color: #f39c12;
        }
        
        .match-score.low {
            background: #ffebee;
            color: #e74c3c;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #2ecc71;
            color: white;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group input {
            width: auto;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .close:hover {
            color: #2c3e50;
        }
        
        .search-item {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .search-item.inactive {
            opacity: 0.6;
            background: #f8f9fa;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 5px;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-secondary {
            background: #e7e7e7;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç Job Search Crawler</h1>
            <button class="btn btn-primary" onclick="triggerCrawl()">Run Search Now</button>
        </header>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="tab" onclick="showTab('jobs')">Jobs</button>
            <button class="tab" onclick="showTab('searches')">Search Criteria</button>
            <button class="tab" onclick="showTab('settings')">Settings</button>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats" id="stats"></div>
            
            <div class="card">
                <h2>Recent Jobs</h2>
                <div id="recent-jobs"></div>
            </div>
        </div>
        
        <!-- Jobs Tab -->
        <div id="jobs" class="tab-content">
            <div class="card">
                <h2>All Jobs</h2>
                <div style="margin-bottom: 15px;">
                    <select id="job-filter" onchange="loadJobs()">
                        <option value="">All Jobs</option>
                        <option value="new">New</option>
                        <option value="viewed">Viewed</option>
                        <option value="applied">Applied</option>
                        <option value="saved">Saved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div id="jobs-list"></div>
            </div>
        </div>
        
        <!-- Search Criteria Tab -->
        <div id="searches" class="tab-content">
            <div class="card">
                <h2>Search Criteria</h2>
                <button class="btn btn-success" style="margin-bottom: 15px;" onclick="showNewSearchModal()">+ Add New Search</button>
                <div id="searches-list"></div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="card">
                <h2>Platform Credentials</h2>
                <form onsubmit="saveCredentials(event, 'linkedin')">
                    <h3>LinkedIn</h3>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="linkedin-email" required>
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="linkedin-password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Save LinkedIn Credentials</button>
                </form>
                
                <hr style="margin: 30px 0;">
                
                <form onsubmit="saveCredentials(event, 'indeed')">
                    <h3>Indeed (Optional)</h3>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="indeed-email">
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="indeed-password">
                    </div>
                    <button type="submit" class="btn btn-primary">Save Indeed Credentials</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- New Search Modal -->
    <div id="search-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSearchModal()">&times;</span>
            <h2>New Search Criteria</h2>
            <form onsubmit="createSearch(event)">
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="search-name" required placeholder="e.g., Senior Python Developer">
                </div>
                <div class="form-group">
                    <label>Keywords:</label>
                    <input type="text" id="search-keywords" required placeholder="e.g., python fastapi">
                </div>
                <div class="form-group">
                    <label>Location:</label>
                    <input type="text" id="search-location" placeholder="e.g., San Francisco, CA">
                </div>
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="search-remote">
                    <label for="search-remote">Remote Only</label>
                </div>
                <div class="form-group">
                    <label>Job Type:</label>
                    <select id="search-job-type">
                        <option value="">Any</option>
                        <option value="full-time">Full-time</option>
                        <option value="contract">Contract</option>
                        <option value="part-time">Part-time</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Platforms:</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="platform-linkedin" checked>
                        <label for="platform-linkedin">LinkedIn</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="platform-indeed" checked>
                        <label for="platform-indeed">Indeed</label>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Create Search</button>
            </form>
        </div>
    </div>
    
    <script>
        const API_BASE = '/api';
        
        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'dashboard') loadDashboard();
            if (tabName === 'jobs') loadJobs();
            if (tabName === 'searches') loadSearches();
        }
        
        // Load dashboard
        async function loadDashboard() {
            try {
                const statsRes = await fetch(`${API_BASE}/stats`);
                const stats = await statsRes.json();
                
                document.getElementById('stats').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${stats.total_jobs}</div>
                        <div class="stat-label">Total Jobs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${stats.new_jobs_24h}</div>
                        <div class="stat-label">New (24h)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${stats.jobs_by_status.applied || 0}</div>
                        <div class="stat-label">Applied</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${stats.active_searches}</div>
                        <div class="stat-label">Active Searches</div>
                    </div>
                `;
                
                const jobsRes = await fetch(`${API_BASE}/jobs?limit=10`);
                const jobs = await jobsRes.json();
                displayJobs(jobs, 'recent-jobs');
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }
        
        // Load jobs
        async function loadJobs() {
            const filter = document.getElementById('job-filter').value;
            const url = filter ? `${API_BASE}/jobs?status=${filter}` : `${API_BASE}/jobs`;
            
            try {
                const res = await fetch(url);
                const jobs = await res.json();
                displayJobs(jobs, 'jobs-list');
            } catch (error) {
                console.error('Error loading jobs:', error);
            }
        }
        
        // Display jobs
        function displayJobs(jobs, containerId) {
            const container = document.getElementById(containerId);
            
            if (jobs.length === 0) {
                container.innerHTML = '<p>No jobs found.</p>';
                return;
            }
            
            container.innerHTML = jobs.map(job => {
                const score = job.ai_match_score || 0;
                const scoreClass = score >= 75 ? 'high' : score >= 50 ? 'medium' : 'low';
                
                return `
                    <div class="job-card ${job.is_new ? 'new' : ''}" onclick="viewJob(${job.id})">
                        <div class="job-title">${job.title}</div>
                        <div class="job-company">${job.company} ${job.location ? '‚Ä¢ ' + job.location : ''}</div>
                        <div class="job-meta">
                            <span>${job.platform}</span>
                            ${job.ai_match_score ? `<span class="match-score ${scoreClass}">Match: ${score}%</span>` : ''}
                            <span>${new Date(job.discovered_at).toLocaleDateString()}</span>
                        </div>
                        ${job.ai_summary ? `<p style="margin-top: 10px; font-size: 13px; color: #7f8c8d;">${job.ai_summary}</p>` : ''}
                    </div>
                `;
            }).join('');
        }
        
        // View job
        function viewJob(jobId) {
            window.open(`/api/jobs/${jobId}`, '_blank');
        }
        
        // Load searches
        async function loadSearches() {
            try {
                const res = await fetch(`${API_BASE}/searches`);
                const searches = await res.json();
                
                const container = document.getElementById('searches-list');
                container.innerHTML = searches.map(s => `
                    <div class="search-item ${!s.is_active ? 'inactive' : ''}">
                        <div>
                            <strong>${s.name}</strong>
                            <div style="font-size: 13px; color: #7f8c8d; margin-top: 5px;">
                                ${s.keywords} ‚Ä¢ ${s.location || 'Any location'}
                                ${s.remote_only ? ' ‚Ä¢ Remote' : ''}
                            </div>
                            <div style="margin-top: 5px;">
                                ${s.platforms.map(p => `<span class="badge badge-secondary">${p}</span>`).join('')}
                                ${s.is_active ? '<span class="badge badge-success">Active</span>' : ''}
                            </div>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="toggleSearch(${s.id}, ${!s.is_active})">
                                ${s.is_active ? 'Deactivate' : 'Activate'}
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading searches:', error);
            }
        }
        
        // Toggle search
        async function toggleSearch(id, activate) {
            try {
                await fetch(`${API_BASE}/searches/${id}`, {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({is_active: activate})
                });
                loadSearches();
            } catch (error) {
                console.error('Error toggling search:', error);
            }
        }
        
        // Show new search modal
        function showNewSearchModal() {
            document.getElementById('search-modal').classList.add('active');
        }
        
        // Close search modal
        function closeSearchModal() {
            document.getElementById('search-modal').classList.remove('active');
        }
        
        // Create search
        async function createSearch(e) {
            e.preventDefault();
            
            const platforms = [];
            if (document.getElementById('platform-linkedin').checked) platforms.push('linkedin');
            if (document.getElementById('platform-indeed').checked) platforms.push('indeed');
            
            const data = {
                name: document.getElementById('search-name').value,
                keywords: document.getElementById('search-keywords').value,
                location: document.getElementById('search-location').value,
                remote_only: document.getElementById('search-remote').checked,
                job_type: document.getElementById('search-job-type').value,
                platforms: platforms
            };
            
            try {
                await fetch(`${API_BASE}/searches`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                closeSearchModal();
                showTab('searches');
                loadSearches();
            } catch (error) {
                console.error('Error creating search:', error);
                alert('Error creating search');
            }
        }
        
        // Save credentials
        async function saveCredentials(e, platform) {
            e.preventDefault();
            
            const data = {
                platform: platform,
                email: document.getElementById(`${platform}-email`).value,
                password: document.getElementById(`${platform}-password`).value
            };
            
            try {
                await fetch(`${API_BASE}/credentials`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                alert(`${platform} credentials saved!`);
            } catch (error) {
                console.error('Error saving credentials:', error);
                alert('Error saving credentials');
            }
        }
        
        // Trigger crawl
        async function triggerCrawl() {
            if (!confirm('Start a manual job search now?')) return;
            
            try {
                const res = await fetch(`${API_BASE}/crawl/run`, {method: 'POST'});
                const data = await res.json();
                alert(`Crawl completed! Found ${data.new_jobs} new jobs.`);
                loadDashboard();
            } catch (error) {
                console.error('Error triggering crawl:', error);
                alert('Error running crawl');
            }
        }
        
        // Initial load
        loadDashboard();
    </script>
</body>
</html>
